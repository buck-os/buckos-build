load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "llvm-mingw",
    version = "20231017",
    install_script = """
        mkdir -p "$OUT/opt/llvm-mingw"
        cp -r "$SRCS"/* "$OUT/opt/llvm-mingw/"

        # Create symlinks in /usr/bin for common tools
        mkdir -p "$OUT/usr/bin"
        for bin in clang clang++ lld llvm-ar llvm-nm llvm-objcopy llvm-objdump llvm-ranlib llvm-strip; do
            if [ -f "$OUT/opt/llvm-mingw/bin/$bin" ]; then
                ln -sf "/opt/llvm-mingw/bin/$bin" "$OUT/usr/bin/mingw-$bin"
            fi
        done
    """,
    visibility = ["PUBLIC"],
)
